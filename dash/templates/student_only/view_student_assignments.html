{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>My Submitted Assignments</h2>

    <!-- Success/Error messages -->
    {% if success %}
        <div class="alert alert-success">{{ success }}</div>
    {% endif %}
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <!-- Set items per page -->
    <form method="get" class="form-inline mb-3">
        <label for="per_page">Items per page:</label>
        <select name="per_page" id="per_page" class="form-control mx-2" onchange="this.form.submit()">
            {% for n in [5, 10, 20, 50] %}
                <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}</option>
            {% endfor %}
        </select>
    </form>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>Assignment Name</th>
                <th>Subject</th>
                <th>Submitted On</th>
                <th>Score</th>
                <th>Grade</th>
                <th>Files</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in submissions %}
                <tr>
                    <td>{{ loop.index + (pagination.page - 1) * pagination.per_page }}</td>
                    <td>{{ submission.assignment_name }}</td>
                    <td>{{ submission.assignment_subject_Name }} ({{ submission.assignment_subject_code }})</td>
                    <td>{{ submission.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ submission.student_score }}</td>
                    <td>{{ submission.student_grade }}</td>
                    <td>
                        {% for f in submission.assignment_submisssion_file_uploads %}
                            <a href="{{ url_for('static', filename='uploads/' ~ f.filename) }}" target="_blank">{{ f.original_name }}</a><br>
                        {% endfor %}
                    </td>
                    <td>
                        <a href="{{ url_for('dash.student_view_submission', submission_id=submission.id) }}" class="btn btn-info btn-sm">View</a>
                        <a href="{{ url_for('dash.student_update_submission', submission_id=submission.id) }}" class="btn btn-warning btn-sm">Add Files</a>
                        <form action="{{ url_for('dash.student_delete_submission', submission_id=submission.id) }}" method="POST" style="display:inline-block;" onsubmit="return confirm('Are you sure?');">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" class="text-center">No submissions found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination links -->
    {% if pagination.pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if pagination.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ pagination.prev_num }}&per_page={{ per_page }}">Previous</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Previous</span></li>
                {% endif %}

                {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                            <a class="page-link" href="?page={{ page_num }}&per_page={{ per_page }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ pagination.next_num }}&per_page={{ per_page }}">Next</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Next</span></li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>
{% endblock %}
